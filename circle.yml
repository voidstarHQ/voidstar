machine:
  environment:
    PATH: "/home/ubuntu/cmake/bin:$PATH"

dependencies:
  cache_directories:
    - ~/cmake
  pre:
    - sudo apt-get update
    - >
      if [ ! -d ~/cmake ]; then
        CMK_VSN=3.7.0
        cd ~ && wget --quiet https://cmake.org/files/v3.7/cmake-$CMK_VSN-Linux-x86_64.tar.gz && tar -xvf cmake-$CMK_VSN-Linux-x86_64.tar.gz && mv cmake-$CMK_VSN-Linux-x86_64 cmake
      else
        echo Cached CMake found
      fi
    - ls -lha ~/cmake/bin
    - echo $PATH
    - sudo apt-get install libglew-dev
    - sudo apt-get install libglm-dev
    - sudo apt-get install xorg-dev libgl1-mesa-dev
    - git clone --branch=latest https://github.com/glfw/glfw.git ~/glfw3 && mkdir ~/glfw3/build && cd ~/glfw3/build && cmake -DBUILD_SHARED_LIBS=ON -DGLFW_BUILD_EXAMPLES=OFF .. && cmake --build . && sudo make install
  post:
    - cmake --version || true
    - g++ --version || true
    - clang++ --version || true

test:
  pre:
    - ./configure -b DEBUG
    - pushd build && make && popd
    - ./configure -b RELEASE
    - pushd build && make && popd

deployment:
  release:
    tag: /.*/
    owner: fenollp
    commands:
      - ./deploy_master.sh
